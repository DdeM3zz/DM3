local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- Загружаем серверный скрипт с GitHub
local serverScriptUrl = "YOUR_GITHUB_RAW_URL"
local success, err = pcall(function()
	loadstring(game:HttpGet(serverScriptUrl))()
end)
if not success then
	warn("Ошибка загрузки серверного скрипта: " .. err)
	return
end

-- Настройки
local FOLLOW_DISTANCE = 3
local HEIGHT_OFFSET = 1.5
local ORBIT_RADIUS = 5
local ORBIT_SPEED = 2
local REPEL_FORCE = 300

-- GUI
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "ModeSwitchGui"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 300, 0, 100)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -50)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Active = true
mainFrame.Draggable = true

local frameCorner = Instance.new("UICorner", mainFrame)
frameCorner.CornerRadius = UDim.new(0, 12)

local uiListLayout = Instance.new("UIListLayout", mainFrame)
uiListLayout.FillDirection = Enum.FillDirection.Horizontal
uiListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
uiListLayout.VerticalAlignment = Enum.VerticalAlignment.Center
uiListLayout.Padding = UDim.new(0, 10)

local function createModeButton(modeName, color)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 120, 0, 50)
	btn.BackgroundColor3 = color
	btn.Text = modeName
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 20
	btn.TextColor3 = Color3.new(1, 1, 1)

	local corner = Instance.new("UICorner", btn)
	corner.CornerRadius = UDim.new(0, 8)

	btn.Name = modeName
	return btn
end

local followBtn = createModeButton("Follow", Color3.fromRGB(50, 100, 220))
local orbitBtn = createModeButton("Orbit", Color3.fromRGB(220, 50, 50))
followBtn.Parent = mainFrame
orbitBtn.Parent = mainFrame

-- Логика GUI
local mode = "Follow"
local angleOffset = 0

local function updateButtons()
	followBtn.BackgroundColor3 = (mode == "Follow") and Color3.fromRGB(50, 150, 250) or Color3.fromRGB(50, 100, 220)
	orbitBtn.BackgroundColor3 = (mode == "Orbit") and Color3.fromRGB(250, 80, 80) or Color3.fromRGB(220, 50, 50)
end

followBtn.MouseButton1Click:Connect(function()
	mode = "Follow"
	updateButtons()
end)

orbitBtn.MouseButton1Click:Connect(function()
	mode = "Orbit"
	updateButtons()
end)

updateButtons()

-- Запрашиваем создание мечей на сервере
local CreateSwordsEvent = ReplicatedStorage:WaitForChild("CreateSwordsEvent")
CreateSwordsEvent:FireServer()

-- Обновление позиций мечей
RunService.RenderStepped:Connect(function(dt)
	angleOffset += ORBIT_SPEED * dt

	for _, player in pairs(Players:GetPlayers()) do
		local character = player.Character
		if not character then continue end
		local hrp = character:FindFirstChild("HumanoidRootPart")
		if not hrp then continue end

		for i = 1, 3 do
			local swordPart = workspace:FindFirstChild("SwordPart_" .. player.Name .. "_" .. (i - 1))
			if not swordPart then continue end

			local offset = Vector3.new(
				(i == 1 and -1.5) or (i == 2 and 1.5) or 0,
				(i == 3 and 0.8) or 0,
				0
			)

			if mode == "Follow" then
				local behindPos = hrp.Position - (hrp.CFrame.LookVector * FOLLOW_DISTANCE)
				behindPos += Vector3.new(0, HEIGHT_OFFSET, 0)
				local finalPos = behindPos + hrp.CFrame:VectorToWorldSpace(offset)

				local baseCFrame = CFrame.new(finalPos, finalPos + hrp.CFrame.LookVector)
				local rotatedCFrame = baseCFrame * CFrame.Angles(0, math.rad(90), 0)

				swordPart.CFrame = swordPart.CFrame:Lerp(rotatedCFrame, 0.1)
			else
				local angle = angleOffset + (math.pi * 2 * (i - 1) / 3)
				local orbitPos = hrp.Position + Vector3.new(math.cos(angle) * ORBIT_RADIUS, HEIGHT_OFFSET, math.sin(angle) * ORBIT_RADIUS)
				swordPart.CFrame = CFrame.new(orbitPos)

				for _, otherPlayer in pairs(Players:GetPlayers()) do
					if otherPlayer ~= player and otherPlayer.Character and otherPlayer.Character:FindFirstChild("HumanoidRootPart") then
						local targetHRP = otherPlayer.Character.HumanoidRootPart
						local dist = (targetHRP.Position - swordPart.Position).Magnitude
						if dist < 4 then
							local dir = (targetHRP.Position - swordPart.Position).Unit
							targetHRP.Velocity += dir * REPEL_FORCE
						end
					end
				end
			end
		end
	end
end)
