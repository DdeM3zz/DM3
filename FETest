-- Клиентская часть (вставляется в экзекутор, например Xeno)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")

-- Уведомление
local function showNotification(message, duration)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = "Duck Drop",
            Text = message,
            Duration = duration or 2
        })
    end)
end

-- Поиск или создание RemoteEvent
local remoteEvent = nil
for _, child in pairs(ReplicatedStorage:GetChildren()) do
    if child:IsA("RemoteEvent") then
        remoteEvent = child
        showNotification("Найден RemoteEvent: " .. child.Name)
        break
    end
end

if not remoteEvent then
    remoteEvent = Instance.new("RemoteEvent")
    remoteEvent.Name = "DuckDropEvent"
    remoteEvent.Parent = ReplicatedStorage
    showNotification("Создан новый RemoteEvent: DuckDropEvent")
end

-- Функция для запуска падения уток
local function dropDucksFromSky()
    showNotification("Запуск падения уток с неба...")
    local success, errorMsg = pcall(function()
        remoteEvent:FireServer("DropDucks", {
            MeshId = "rbxassetid://14116572762", -- MeshId утки
            TextureId = "rbxassetid://14116572804", -- Текстура утки
            Scale = Vector3.new(1, 1, 1),
            DuckCount = 5 -- Количество уток на игрока
        })
    end)
    if success then
        showNotification("Запрос отправлен на сервер!")
    else
        showNotification("Ошибка отправки: " .. tostring(errorMsg))
    end
end

-- Запуск при нажатии клавиши (например, T)
local UserInputService = game:GetService("UserInputService")
UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.T then
        dropDucksFromSky()
    end
end)

-- Серверная часть (для полноты, обычно в ServerScriptService)
if game:GetService("RunService"):IsServer() then
    local remoteEvent = Instance.new("RemoteEvent", ReplicatedStorage)
    remoteEvent.Name = "DuckDropEvent"

    remoteEvent.OnServerEvent:Connect(function(player, action, data)
        if action == "DropDucks" then
            local success, errorMsg = pcall(function()
                for _, p in pairs(Players:GetPlayers()) do
                    local char = p.Character
                    if char then
                        local hrp = char:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            -- Создаём уток для каждого игрока
                            for i = 1, data.DuckCount do
                                local duckPart = Instance.new("Part")
                                duckPart.Size = Vector3.new(1, 1, 1)
                                duckPart.Position = hrp.Position + Vector3.new(
                                    math.random(-10, 10),
                                    50, -- Высота над игроком
                                    math.random(-10, 10)
                                )
                                duckPart.Anchored = true
                                duckPart.CanCollide = true

                                local mesh = Instance.new("SpecialMesh")
                                mesh.MeshId = data.MeshId
                                mesh.TextureId = data.TextureId
                                mesh.Scale = data.Scale
                                mesh.Parent = duckPart

                                -- Прикрепляем временно как "аксессуар"
                                local weld = Instance.new("WeldConstraint")
                                weld.Part0 = hrp
                                weld.Part1 = duckPart
                                weld.Parent = duckPart

                                duckPart.Parent = char

                                -- Открепляем и заставляем падать
                                task.delay(1, function()
                                    weld:Destroy()
                                    duckPart.Anchored = false
                                    local bodyVelocity = Instance.new("BodyVelocity")
                                    bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
                                    bodyVelocity.Velocity = Vector3.new(0, -30, 0)
                                    bodyVelocity.Parent = duckPart
                                    task.delay(10, function()
                                        bodyVelocity:Destroy()
                                    end)
                                    -- Удаляем утку через 30 секунд
                                    task.delay(30, function()
                                        duckPart:Destroy()
                                    end)
                                end)
                            end
                        end
                    end
                end
            end)
            if not success then
                warn("Ошибка на сервере: " .. tostring(errorMsg))
            end
        end
    end)
end
